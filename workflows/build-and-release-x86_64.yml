on: [push]

name: 'Extract Windows 8.1 sdk'

permissions:
  contents: write

jobs:
  upload-release:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: create release
      id: create_release
      uses: actions/create-release@master
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: 8.1
        release_name: Windows SDK 8.1
        draft: false
        prerelease: false   
    
    - name: Download SDK installer
      run: curl -SL --output sdksetup.exe https://go.microsoft.com/fwlink/p/?LinkId=323507

    - name: Install SDK
      run: sdksetup.exe /features OptionId.WindowsDesktopSoftwareDevelopmentKit OptionId.NetFxSoftwareDevelopmentKit /quiet
    
    - name: Copy and zip windows SDK files
      run: mkdir include && mkdir lib && (cp "C:\Program Files (x86)\Windows Kits\8.1\Include\um" include\) && (cp "C:\Program Files (x86)\Windows Kits\8.1\Lib\winv6.3\um" lib\) && Compress-Archive -Path "include", "lib" -DestinationPath "C:\winsdk.zip"

    - name: upload windows 8.1 sdk
      id: upload-windows-8.1
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: C:\winsdk.zip
        asset_name: winsdk.zip
        asset_content_type: application/zip